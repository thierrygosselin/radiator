<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute pairwise genome similarity or distance between individuals to highligh potential duplicate individuals — detect_duplicate_genomes • radiator</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute pairwise genome similarity or distance between individuals to highligh potential duplicate individuals — detect_duplicate_genomes"><meta property="og:description" content="The function can compute two methods
to highligh potential duplicate individuals.
distance between individuals and/or
pairwise genome similarity

"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">radiator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Installation</a>
</li>
<li>
  <a href="../articles/get_started.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/rad_genomics_computer_setup.html">Computer setup - Installation - Troubleshooting</a>
    </li>
    <li>
      <a href="../articles/life_cycle.html">Life cycle</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/thierrygosselin/radiator" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute pairwise genome similarity or distance between individuals to highligh potential duplicate individuals</h1>
    <small class="dont-index">Source: <a href="https://github.com/thierrygosselin/radiator/blob/HEAD/R/detect_duplicate_genomes.R" class="external-link"><code>R/detect_duplicate_genomes.R</code></a></small>
    <div class="hidden name"><code>detect_duplicate_genomes.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function can compute two methods
to highligh potential duplicate individuals.</p><ol><li><p>distance between individuals and/or</p></li>
<li><p>pairwise genome similarity</p></li>
</ol></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">detect_duplicate_genomes</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  interactive.filter <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  detect.duplicate.genomes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dup.threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  distance.method <span class="op">=</span> <span class="st">"manhattan"</span>,</span>
<span>  genome <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  threshold.common.markers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  blacklist.duplicates <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel.core <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>(4 options) A file or object generated by radiator:</p><ul><li><p>tidy data</p></li>
<li><p>Genomic Data Structure (GDS)</p></li>
</ul><p><em>How to get GDS and tidy data ?</em>
Look into <code><a href="tidy_genomic_data.html">tidy_genomic_data</a></code>,
<code><a href="read_vcf.html">read_vcf</a></code> or
<code><a href="tidy_vcf.html">tidy_vcf</a></code>.</p></dd>


<dt id="arg-interactive-filter">interactive.filter<a class="anchor" aria-label="anchor" href="#arg-interactive-filter"></a></dt>
<dd><p>(optional, logical) Do you want the filtering session to
be interactive. Figures of distribution are shown before asking for filtering
thresholds.
Default: <code>interactive.filter = TRUE</code>.</p></dd>


<dt id="arg-detect-duplicate-genomes">detect.duplicate.genomes<a class="anchor" aria-label="anchor" href="#arg-detect-duplicate-genomes"></a></dt>
<dd><p>(optional, logical) For use inside radiator pipelines.
Default: <code>detect.duplicate.genomes = TRUE</code>.</p></dd>


<dt id="arg-dup-threshold">dup.threshold<a class="anchor" aria-label="anchor" href="#arg-dup-threshold"></a></dt>
<dd><p>Default: <code>dup.threshold = 0</code>. Turn off filter.</p></dd>


<dt id="arg-distance-method">distance.method<a class="anchor" aria-label="anchor" href="#arg-distance-method"></a></dt>
<dd><p>(character) Depending on input data, 2 different methods
are used (give similar results):</p><ul><li><p>gds data The calculation is fast it's <code><a href="https://rdrr.io/pkg/SNPRelate/man/snpgdsIBS.html" class="external-link">SNPRelate::snpgdsIBS</a></code> under
the hood.</p></li>
<li><p>tidy data The distance measure uses <code><a href="https://rdrr.io/pkg/amap/man/dist.html" class="external-link">amap::Dist</a></code>.
This must be one of "euclidean", "maximum", "manhattan", "canberra", "binary".</p></li>
</ul><p>Using <code>distance.method = NULL</code> will not run this method.
Default: <code>distance.method = "manhattan"</code>. This is very fast
compared to the genome similarity method. It uses allele counts and the codes
are tailored for biallelic and multiallelic markers.</p></dd>


<dt id="arg-genome">genome<a class="anchor" aria-label="anchor" href="#arg-genome"></a></dt>
<dd><p>(logical) Computes pairwise genome similarity in parallel.
The proportion of the shared genotypes is averaged across shared markers between
each pairwise comparison. This method makes filtering easier because the
threshold is more intuitive with the plots produced, but it's much longer
to run, even in parallel, so better to run overnight.
Default: <code>genome = FALSE</code>.</p></dd>


<dt id="arg-threshold-common-markers">threshold.common.markers<a class="anchor" aria-label="anchor" href="#arg-threshold-common-markers"></a></dt>
<dd><p>(double, optional) When using the
pairwise genome similarity approach (<code>genome = TRUE</code>), using a threshold
will filter the pairwise comparison before generating the results. This is
usefull if the number of pairwise comparisons (n*(n-1)/2) is very large and
allows to reduce the number of false positive, when missing data is involved.
e.g. 2 samples might have 100<!-- % markers in common, but if they only have -->
30<!-- % of their genotyped markers in common, this is a poor fit. -->
Default: <code>threshold.common.markers = NULL</code>.</p></dd>


<dt id="arg-blacklist-duplicates">blacklist.duplicates<a class="anchor" aria-label="anchor" href="#arg-blacklist-duplicates"></a></dt>
<dd><p>(optional, logical)
With <code>blacklist.duplicates = TRUE</code>, after visualization,
the user is asked to enter a threshold to filter out duplicates.
With default, <code>blacklist.duplicates = FALSE</code>, the function as no
interaction with user.</p></dd>


<dt id="arg-parallel-core">parallel.core<a class="anchor" aria-label="anchor" href="#arg-parallel-core"></a></dt>
<dd><p>(optional) The number of core used for parallel
execution during import.
Default: <code>parallel.core = parallel::detectCores() - 1</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>(optional, logical) When <code>verbose = TRUE</code>
the function is a little more chatty during execution.
Default: <code>verbose = TRUE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>(optional) Advance mode that allows to pass further arguments
for fine-tuning the function. Also used for legacy arguments (see details or
special section)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list with potentially 8 objects:</p><ul><li><p><code>$distance </code>: results of the distance method.</p></li>
<li><p><code>$distance.stats</code>: Summary statistics of the distance method.</p></li>
<li><p><code>$pairwise.genome.similarity</code>: results of the genome method.</p></li>
<li><p><code>$genome.stats</code>: Summary statistics of the genome method.</p></li>
<li><p><code>$violin.plot.distance</code>: violin plot showing the distribution of pairwise distances.</p></li>
<li><p><code>$manhattan.plot.distance</code>: same info different visual with manhattan plot.</p></li>
<li><p><code>$violin.plot.genome</code>: violin plot showing the distribution of pairwise genome similarities.</p></li>
<li><p><code>$manhattan.plot.genome</code>: same info different visual with manhattan plot.</p></li>
<li><p><code>$blacklist.id.similar</code>: blacklisted duplicates.</p></li>
</ul><p>Saved in the working directory:
individuals.pairwise.dist.tsv, individuals.pairwise.distance.stats.tsv,
individuals.pairwise.genome.similarity.tsv, individuals.pairwise.genome.stats.tsv,
blackliste.id.similar.tsv, blacklist.pairs.threshold.tsv</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Strategically, run the default first (<code>distance.method</code>,
no <code>genome</code>)</p>
<p><strong><code>distance.method</code> argument is fast, but...</strong></p>
<p>you don't know if the observed comparison (close or distant)
is influenced by missing values/the number of markers in common
between the pair compared. This is something that needs to be considered.
Be suspicious of a <em>distant outlier</em> from the same pop pairwise comparison,
and similarly, be suspicious of a <em>close outlier</em> from a different pop
pairwise comparisons.</p>
<p>If there is no outlier, don't bother running the function again with
(<code>genome = TRUE</code>).</p>
<p><strong>Relative distance</strong></p>
<p>Is the normalized distance for your dataset (not calculated by strata). For
each individual, it's the distance divided by the maximum distance observed.
The range is limited between 0 and 1. Closer to 0 = the more similar and
closer to 1, the more distant.</p>
<p><strong><code>genome = TRUE</code></strong></p>
<p>The function will run slower, but...
If you see outliers with the first run, take the time to run the function
with <code>genome = TRUE</code>. Because this option is much better at detecting
duplicated individuals and it also shows the impact of <strong>missingness</strong>
or the number of <strong>shared markers</strong> between comparisons.</p>
<p><em>Your outlier duo could well be the result of one of the individual having
an extremely low number of genotypes...</em></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Thierry Gosselin <a href="mailto:thierrygosselin@icloud.com">thierrygosselin@icloud.com</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># First run and simplest way (if you have the tidy tibble):</span></span></span>
<span class="r-in"><span><span class="va">dup</span> <span class="op">&lt;-</span> <span class="fu">radiator</span><span class="fu">::</span><span class="fu">detect_duplicate_genomes</span><span class="op">(</span>data <span class="op">=</span> <span class="st">"wombat_tidy.rad"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This will use by default:</span></span></span>
<span class="r-in"><span><span class="co"># distance.method = "manhattan"</span></span></span>
<span class="r-in"><span><span class="co"># genome = FALSE</span></span></span>
<span class="r-in"><span><span class="co"># parallel.core = all my CPUs - 1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you need a tidy tibble: use one of radiator \code{tidy_} function or</span></span></span>
<span class="r-in"><span><span class="co"># \code{radiator::tidy_genomic_data}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To view the manhattan plot:</span></span></span>
<span class="r-in"><span><span class="va">dup</span><span class="op">$</span><span class="va">manhattan.plot.distance</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to view the data stats</span></span></span>
<span class="r-in"><span><span class="va">dup.data.stats</span> <span class="op">&lt;-</span> <span class="va">dup</span><span class="op">$</span><span class="va">distance.stats</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to view the data</span></span></span>
<span class="r-in"><span><span class="va">dup.data</span> <span class="op">&lt;-</span> <span class="va">dup</span><span class="op">$</span><span class="va">distance</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Based on the look of the distribution using both manhattan and boxplot,</span></span></span>
<span class="r-in"><span><span class="co"># I can filter the dataset to highlight potential duplicates.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To run the distance (with euclidean distance instead of the default manhattan,</span></span></span>
<span class="r-in"><span><span class="co"># and also carry the second analysis (with the genome method):</span></span></span>
<span class="r-in"><span><span class="va">dup</span> <span class="op">&lt;-</span> <span class="fu">radiator</span><span class="fu">::</span><span class="fu"><a href="tidy_genomic_data.html">tidy_genomic_data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">wombat_tidy_object</span>,</span></span>
<span class="r-in"><span>    strata <span class="op">=</span> <span class="st">"wombat.strata.tsv"</span>,</span></span>
<span class="r-in"><span>    vcf.metadata <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span><span class="fu">radiator</span><span class="fu">::</span><span class="fu">detect_duplicate_genomes</span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">.</span>,</span></span>
<span class="r-in"><span>    distance.method <span class="op">=</span> <span class="st">"euclidean"</span>,</span></span>
<span class="r-in"><span>    genome <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to view the data of the genome data</span></span></span>
<span class="r-in"><span><span class="va">dup.data</span> <span class="op">&lt;-</span> <span class="va">dup</span><span class="op">$</span><span class="va">pairwise.genome.similarity</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Based on the look of the distribution using both manhattan and boxplot,</span></span></span>
<span class="r-in"><span><span class="co"># I can filter the dataset based on 98% of identical genotype proportion,</span></span></span>
<span class="r-in"><span><span class="co"># to highlight potential duplicates:</span></span></span>
<span class="r-in"><span><span class="va">dup.filtered</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">dup.data</span>, <span class="va">PROP_IDENTICAL</span> <span class="op">&gt;</span> <span class="fl">0.98</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get the list of duplicates id</span></span></span>
<span class="r-in"><span><span class="va">dup.list.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>INDIVIDUALS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dup.filtered</span><span class="op">$</span><span class="va">ID1</span>, <span class="va">dup.filtered</span><span class="op">$</span><span class="va">ID2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Thierry Gosselin.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

